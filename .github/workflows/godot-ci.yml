name: "godot-ci export"
on: push

env:
    GODOT_VERSION: 3.2.3
    EXPORT_NAME: save-the-hangman
    ITCH_GAME: save-the-hangman
    ITCH_USER: team-kebab

jobs:
    export-windows:
        name: Windows Export
        runs-on: ubuntu-latest
        container:
          image: barichello/godot-ci:3.2.3
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            with:
              lfs: true
          - name: Setup
            run: |
              mkdir -v -p ~/.local/share/godot/templates
              mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          - name: Windows Build
            run: |
              mkdir -v -p build/windows
              cd $EXPORT_NAME
              godot -v --export "Windows Desktop" ../build/windows/$EXPORT_NAME.exe
          - name: Upload Artifact
            uses: actions/upload-artifact@v1
            with:
              name: windows
              path: build/windows
          - name: Publish to Itch.io
            uses: josephbmanley/butler-publish-itchio-action@master
            env:
              BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
              CHANNEL: windows
              PACKAGE: build/windows
    export-linux:
        name: Linux Export
        runs-on: ubuntu-latest
        container:
          image: barichello/godot-ci:3.2.3
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            with:
              lfs: true
          - name: Setup
            run: |
              mkdir -v -p ~/.local/share/godot/templates
              mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          - name: Linux Build
            run: |
              mkdir -v -p build/linux
              cd $EXPORT_NAME
              godot -v --export "Linux/X11" ../build/linux/$EXPORT_NAME.x86_64
          - name: Upload Artifact
            uses: actions/upload-artifact@v1
            with:
              name: linux
              path: build/linux
    
    export-web:
        name: Web Export
        runs-on: ubuntu-latest
        container:
          image: barichello/godot-ci:3.2.3
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            with:
              lfs: true
          - name: Setup
            run: |
              mkdir -v -p ~/.local/share/godot/templates
              mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          - name: Web Build
            run: |
              mkdir -v -p build/web
              cd $EXPORT_NAME
              godot -v --export "HTML5" ../build/web/index.html
          - name: Upload Artifact
            uses: actions/upload-artifact@v1
            with:
              name: web
              path: build/web
    
    export-mac:
        name: Mac Export
        runs-on: ubuntu-latest
        container:
          image: barichello/godot-ci:3.2.3
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            with:
              lfs: true
          - name: Setup
            run: |
              mkdir -v -p ~/.local/share/godot/templates
              mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          - name: Mac Build
            run: |
              mkdir -v -p build/mac
              cd $EXPORT_NAME
              godot -v --export "Mac OSX" ../build/mac/$EXPORT_NAME.zip
          - name: Upload Artifact
            uses: actions/upload-artifact@v1
            with:
              name: mac
              path: build/mac
    
